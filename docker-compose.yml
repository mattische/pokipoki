services:
  poker-planning: 
    image: mattische/pokipoki:latest  # pushad image n Docker Hub
    # build: .  # uncomment if building locally instead
    pull_policy: always  # always latest version
    container_name: pokipoki
    expose:
      - "3000"
    environment: 
      - NODE_ENV=${NODE_ENV:-production}
      - PORT=3000
      - JWT_SECRET=${JWT_SECRET}
    restart: unless-stopped
    networks: 
      - pokipoki-network

  caddy:
    image:  caddy:2-alpine
    container_name: pokipoki-caddy
    restart:  unless-stopped
    ports: 
      - "80:80"
      - "443:443"
      - "443:443/udp"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile
      - caddy_data:/data
      - caddy_config:/config
    environment: 
      - DOMAIN=${DOMAIN:-pokerplanning. duckdns.org}
    networks:
      - pokipoki-network
    depends_on:
      - poker-planning

  # Development service with volume mapping
  poker-planning-dev: 
    build: .  # builds locally for development
    container_name: pokipoki-dev
    ports:
      - "3001:3000"
    environment:
      - NODE_ENV=development
      - PORT=3
